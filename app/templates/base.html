{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="{% static 'icons/senac.svg' %}" type="image/x-icon">
    <!-- RESET CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"
        integrity="sha512-NmLkDIU1C/C88wi324HBc+S2kLhi08PN5GDeUVVVC/BVt/9Izdsc9SVeVfA1UZbY3sHUlDSyRXhCzHfr6hmPPw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <!-- MEU CSS -->
    <link rel="stylesheet" href="{% static 'styles/base.css' %}">
    <link rel="stylesheet" href="{% static 'styles/home.css' %}">
    <link rel="stylesheet" href="{% static 'styles/login.css' %}">
    <link rel="stylesheet" href="{% static 'styles/reg_usuario.css' %}">
    <title>{% block title %}Home{% endblock %}</title>
</head>
<body>
    {% block content %}
    {% endblock %}
    {% block footer %}
        {% include 'partials/footer/footer.html' %} <!-- Footer padrão, pode ser sobrescrito -->
    {% endblock %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
    <script src="{% static 'scripts/see_password.js' %}" type="module"></script>
    <script src="{% static 'scripts/valid_cpf.js' %}" type="module"></script>
    <script src="{% static 'scripts/activate_button.js' %}" type="module"></script>
    <script src="{% static 'scripts/mask_price.js' %}"></script>
    <script src="{% static 'scripts/mask_limit.js' %}"></script>

    <script>
    let setorCount = 1;
    const remainingSeats = {{ context.remaining_seats|default:0 }};
    const setorFields = document.getElementById('setor-fields');
    const addSetorButton = document.getElementById('add-setor');
    const submitButton = document.getElementById('submit_setor');
    const seatsAlert = document.getElementById('seats_alert');

    addSetorButton.addEventListener('click', function() {
        const newRow = document.createElement('div');
        newRow.className = 'setor-row mb-3';
        newRow.innerHTML = `
            <div class="mb-3">
                <label for="nome_setor_${setorCount}" class="form-label color_marrom">Nome do setor:</label>
                <input type="text" class="form-control" id="nome_setor_${setorCount}" name="nome_setor[]" placeholder="Nome aqui" required>
            </div>
            <div class="mb-3">
                <label for="limit_seats_${setorCount}" class="form-label color_marrom">Quantidade de cadeiras:</label>
                <input type="text" class="form-control" id="limit_seats_${setorCount}" name="limit_seats[]" placeholder="Quantidade de cadeiras" required>
            </div>
        `;
        setorFields.appendChild(newRow);
        setorCount++;
    });

    document.getElementById('setor-form').addEventListener('submit', function(e) {
        let totalSeats = 0;
        const seatsInputs = document.getElementsByName('limit_seats[]');
        for (let input of seatsInputs) {
            const value = parseFloat(input.value.replace(/\D/g, '')) || 0;
            totalSeats += value;
        }
        if (totalSeats > remainingSeats) {
            e.preventDefault();
            seatsAlert.style.display = 'block';
            submitButton.disabled = true;
        } else {
            seatsAlert.style.display = 'none';
            submitButton.disabled = false;
        }
    });

    // Validação em tempo real para cada campo
    document.querySelectorAll('[name="limit_seats[]"]').forEach(input => {
        input.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            e.target.value = value;
        });
    });
</script>
</body>
</html>